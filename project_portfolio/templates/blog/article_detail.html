{% extends 'base.html' %}
{% load static %}

{% block title %}{{ article.title }} | {{ author }}{% endblock %}

{% block content %}
<article class="article-detail">
    <header class="article-header">
        <a href="{% url 'blog_list' %}" class="back-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            Back to Blog
        </a>

        <div class="article-meta">
            <span class="article-date">{{ article.published_at|date:"F d, Y" }}</span>
            <span class="article-reading-time">{{ article.reading_time }} min read</span>
        </div>

        <h1 class="article-title">{{ article.title }}</h1>

        <div class="article-tags">
            {% for tag in article.tags.all %}
            <a href="{% url 'blog_by_tag' tag.slug %}" class="article-tag">{{ tag.name }}</a>
            {% endfor %}
        </div>
    </header>

    {% if article.get_featured_image %}
    <div class="article-featured-image">
        <img src="{{ article.get_featured_image }}" alt="{{ article.title }}">
    </div>
    {% endif %}

    <div class="article-body" id="article-content">
        {{ article.content }}
    </div>

    <!-- Share Links -->
    <div class="article-share">
        <span>Share this article:</span>
        <div class="share-links">
            <a href="https://twitter.com/intent/tweet?text={{ article.title|urlencode }}&url={{ request.build_absolute_uri }}"
               target="_blank" class="share-link" aria-label="Share on Twitter">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
            </a>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri }}&title={{ article.title|urlencode }}"
               target="_blank" class="share-link" aria-label="Share on LinkedIn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                </svg>
            </a>
        </div>
    </div>

    <!-- Related Articles -->
    {% if related_articles %}
    <section class="related-articles">
        <h2>Related Articles</h2>
        <div class="related-articles-grid">
            {% for related in related_articles %}
            <article class="article-card article-card--small">
                <div class="article-content">
                    <h3><a href="{{ related.get_absolute_url }}">{{ related.title }}</a></h3>
                    <div class="article-meta">
                        <span class="article-date">{{ related.published_at|date:"M d, Y" }}</span>
                        <span class="article-reading-time">{{ related.reading_time }} min</span>
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</article>
{% endblock %}

{% block extra_js %}
<!-- Marked.js for Markdown rendering -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
(function() {
    'use strict';

    const contentEl = document.getElementById('article-content');
    if (contentEl && typeof marked !== 'undefined') {
        const content = contentEl.textContent;
        // Check if content contains markdown syntax
        if (content.includes('```') || content.includes('##') || content.includes('**') || content.includes('- ')) {
            marked.setOptions({
                breaks: true,
                gfm: true,
                highlight: function(code, lang) {
                    return code;
                }
            });
            contentEl.innerHTML = marked.parse(content);
        } else {
            // Just convert line breaks for plain text
            contentEl.innerHTML = content.replace(/\n/g, '<br>');
        }
    }
})();
</script>
{% endblock %}
